---
title: Release Notes 1.10
description: Highlights and changes in Nauthilus 1.10.x
keywords: [Release Notes, 1.10]
sidebar_position: 10
---

# 1.10.x Release Notes

This page summarizes notable changes in the 1.10 minor series. Patch-level releases are listed below.

> New admin-visible features in 1.10 focus on LDAP robustness, efficiency, and observability. Most changes are opt-in and ship with conservative defaults.

## Highlights

- LDAP Backpressure and Queueing
  - Per-pool queue limits with drop policy and metrics.
- Context- and Deadline-awareness
  - Respect client deadlines when acquiring pool capacity or connecting.
- Timeouts, Retries, Circuit Breaker
  - Per-op timeouts; jittered retries for transient network errors; per-target circuit breaker.
- Target Selection & Health
  - Least-outstanding selection, passive/active health integration, breaker-aware picking.
- Request Optimization & Caching
  - Negative cache with singleflight; optional LRU cache; raw result shaping.
- Robustness & Security
  - Lame-duck connection handling; RFC4515 filter escaping; optional per-pool auth rate limits.
- Observability
  - New metrics for errors, retries, breaker state, target health/inflight, and queue depth/wait/drops.

## Configuration changes (New in v1.10.0)

All keys documented on the LDAP backend page and in the Full Configuration Example. Quick overview:

- Queue limits per pool:
  - `lookup_queue_length`, `auth_queue_length` (0 = unlimited)
- Operation timeouts:
  - `search_timeout`, `bind_timeout`, `modify_timeout`
- Search guardrails:
  - `search_size_limit`, `search_time_limit`
- Retry/backoff and breaker:
  - `retry_max`, `retry_base`, `retry_max_backoff`
  - `cb_failure_threshold`, `cb_cooldown`, `cb_half_open_max`
- Health checks:
  - `health_check_interval`, `health_check_timeout`
- Caching and shaping:
  - `dn_cache_ttl`, `membership_cache_ttl`, `negative_cache_ttl`
  - `cache_max_entries`, `cache_impl` (ttl|lru), `include_raw_result`
- Optional per-pool rate limiting:
  - `auth_rate_limit_per_second`, `auth_rate_limit_burst`

Lua:
- Introduced `backend_number_of_workers` for Lua backend workers.
- Deprecated `number_of_workers` in favor of `backend_number_of_workers` (still supported for compatibility).
- Action workers: removed environment variable; use `lua.config.action_number_of_workers` in configuration.
- New vm pool size keys for non-worker categories: `feature_vm_pool_size`, `filter_vm_pool_size`, `hook_vm_pool_size` (fallback to backend workers if unset).
- Action VM pool size is now automatically coupled 1:1 to `action_number_of_workers` (no separate key).

See:
- Configuration → Full Configuration Example
- Configuration → Database Backends → LDAP Backend
- Configuration → Database Backends → Lua Backend

## Security and protection (New in v1.10.0)

- Account Protection dry‑run mode by default:
  - New environment variable `PROTECT_ENFORCE_REJECT` controls enforcement.
  - Default behavior (unset or "false"): do not block in the Account Protection filter; instead apply progressive delay and set Step‑Up hints.
  - When set to `true`: restores the previous behavior and actively rejects unauthenticated requests while protection is active.
  - Exposed headers for HTTP/OIDC frontends:
    - `X-Nauthilus-Protection: stepup`
    - `X-Nauthilus-Protection-Reason: <reasons>`
    - `X-Nauthilus-Protection-Mode: dry-run` (only when enforcement is disabled)
  - Redis keys for coordination: `ntc:acct:<username>:protection`, `ntc:acct:<username>:stepup`, `ntc:acct:protection_active`.

- Scoped IP normalization and cluster‑wide dedup for metrics:
  - New Lua configuration options under `lua.config`:
    - `ip_scoping_v6_cidr` (e.g., 64 for IPv6 /64 privacy normalization)
    - `ip_scoping_v4_cidr` (e.g., 24 for IPv4 /24 NAT aggregation)
  - New Lua API function `nauthilus_misc.scoped_ip(ctx, ip)` that wraps the Go scoper for consistent results across components.
    - Contexts: `"lua_generic"` (default), `"rwp"`, `"tolerations"`.
  - Long‑window per‑account metrics (`uniq_ips_24h`, `uniq_ips_7d`) can now be based on scoped IPs, reducing false positives from IPv6 privacy rotation and multi‑node duplication.

- Guidance: Start with `ip_scoping_v6_cidr: 64` and `ip_scoping_v4_cidr: 24` and adjust thresholds in Account Protection accordingly. See the Account Protection docs for details.

## Logging (migration to slog) — New in v1.10.0

Nauthilus switched the internal logging from go-kit/log (+ level) to Go's standard library log/slog. This affects field names and formatting. Admins should be aware of the following changes:

- Timestamps: the field was previously named `ts` (go-kit). With slog it is named `time`.
- Caller/source information: previously `caller`; with slog it is `source` when enabled and it renders differently:
  - JSON: a structured object, e.g. `{"source":{"file":"server/core/http.go","line":123}}`.
  - Text: a compact suffix like `source=server/core/http.go:123`.
- Message: go-kit patterns often logged a key `msg="..."`. With slog the message is a dedicated field; our compatibility wrapper extracts `msg` and places it into the message column. The `msg` key is not duplicated in attributes.
- Level: no separate `level` key needs to be added by callers; slog renders the level automatically.

New configuration:
- `server.log.add_source` (bool): controls whether slog includes `source` (file:line). Default: `false`. See configuration docs for details and performance notes.

Examples
- Previous JSON (kit/log):
  - `{ "ts":"2024-11-30T12:34:56Z", "level":"info", "caller":"core/http.go:42", "msg":"HTTP request", "path":"/ping" }`
- New JSON (slog):
  - `{ "time":"2024-11-30T12:34:56Z", "level":"INFO", "msg":"HTTP request", "path":"/ping", "source":{"file":"server/core/http.go","line":42} }`

Notes
- The exact text rendering differs between Text and JSON handlers; JSON is recommended for machine processing.
- The migration is backward compatible for most log call sites due to an internal wrapper, but field names in outputs change as described above.

## Metrics (Prometheus)

New and extended metrics added in 1.10:

- `ldap_errors_total{pool,op,code}`
- `ldap_retries_total{pool,op}`
- `ldap_breaker_state{pool,target}`
- `ldap_target_health{pool,target}`
- `ldap_target_inflight{pool,target}`
- `ldap_queue_depth{pool,type}`
- `ldap_queue_wait_seconds{pool,type}`
- `ldap_queue_dropped_total{pool,type}`
- Cache metrics:
  - `ldap_cache_hits_total{pool,type}`
  - `ldap_cache_misses_total{pool,type}`
  - `ldap_cache_entries{pool,type}`
  - `ldap_cache_evictions_total{pool,type}`
    - Note: With the shared TTL cache implementation, evictions are reported with labels pool="shared", type="ttl"; per-pool eviction metrics are available when using the LRU cache implementation.

## Upgrade and compatibility notes

- Defaults are conservative; most new behaviors are disabled unless configured (e.g., queue limits, rate limits, include_raw_result=false remains default).
- Account Protection: enforcement is now opt‑in. Default is dry‑run (no blocking). Set `PROTECT_ENFORCE_REJECT=true` to enforce rejections while protection is active.
- If you rely on unbounded queues, consider setting `lookup_queue_length`/`auth_queue_length` explicitly to 0 (unlimited) to preserve behavior.
- When enabling search guardrails, validate protocol filters and attribute projections to avoid server-side size/time limit hits.

## 1.10.0

Initial 1.10 release bringing all features listed above.
